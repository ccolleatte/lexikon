# Lexikon Production Configuration - Multi-Tenant Example
#
# Ce fichier est un exemple pour déploiement sur serveur partagé (multi-tenant).
# Copier en .env.prod et adapter les valeurs pour votre environnement.
#
# ⚠️ IMPORTANT: Ne JAMAIS committer .env.prod (contient secrets)
# ⚠️ SECURITY: Générer tous les secrets avec: openssl rand -hex 32

# =====================================================================
# APPLICATION
# =====================================================================

# Frontend URL (doit correspondre au domaine du serveur)
FRONTEND_URL=https://lexikon.votre-domaine.com

# CORS Origins (domaines autorisés à faire des requêtes)
# En production, NE JAMAIS utiliser le wildcard "*"
CORS_ORIGINS=https://lexikon.votre-domaine.com

# Environment
ENVIRONMENT=production
DEBUG=false

# =====================================================================
# DATABASE - POSTGRESQL
# =====================================================================

# Credentials
POSTGRES_DB=lexikon
POSTGRES_USER=lexikon
POSTGRES_PASSWORD=CHANGE_ME_GENERATE_WITH_openssl_rand_hex_32

# Database URL (format SQLAlchemy)
# Note: Port 5432 est utilisé DANS le conteneur
# Le port hôte (5434) est mappé dans docker-compose.prod.yml
DATABASE_URL=postgresql://lexikon:CHANGE_ME_GENERATE_WITH_openssl_rand_hex_32@postgres:5432/lexikon

# =====================================================================
# CACHE - REDIS
# =====================================================================

REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_PREFIX=lexikon:
REDIS_PASSWORD=CHANGE_ME_GENERATE_WITH_openssl_rand_hex_32

# =====================================================================
# SECURITY
# =====================================================================

# JWT Configuration
JWT_SECRET=CHANGE_ME_GENERATE_WITH_openssl_rand_hex_32
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=60
REFRESH_TOKEN_EXPIRE_DAYS=7

# API Key Secret (pour HMAC-SHA256 signing)
API_KEY_SECRET=CHANGE_ME_GENERATE_WITH_openssl_rand_hex_32

# =====================================================================
# OAUTH (Optional)
# =====================================================================

# Google OAuth
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GOOGLE_REDIRECT_URI=https://lexikon.votre-domaine.com/oauth/callback/google

# =====================================================================
# UVICORN (Backend Server Configuration)
# =====================================================================

# Nombre de workers Uvicorn
# Formule: (2 × CPU_cores) + 1
# Multi-tenant recommandé: 2-4 (économiser CPU)
# Standalone: 4-8 (plus de workers = plus de throughput)
UVICORN_WORKERS=4

# Timeout pour les requêtes WebSocket (secondes)
UVICORN_TIMEOUT=120

# Timeout de shutdown graceful (secondes)
UVICORN_GRACEFUL_TIMEOUT=30

# HTTP Keep-Alive timeout (secondes)
UVICORN_KEEP_ALIVE=30

# =====================================================================
# PORTS MULTI-TENANT
# =====================================================================

# ⚠️ IMPORTANT: Sur serveur multi-tenant, adapter les ports pour éviter conflits
# Ces valeurs sont EXEMPLE pour chessplorer.com
# Adapter selon ports disponibles sur votre serveur

# Dans docker-compose.prod.yml, remplacer:
#   nginx:
#     ports:
#       - "8080:80"      # Adapter 8080 si occupé
#       - "8443:443"     # Adapter 8443 si occupé
#   postgres:
#     ports:
#       - "5434:5432"    # Adapter 5434 si occupé
#   uptime-kuma (si utilisé):
#     ports:
#       - "3010:3001"    # Adapter 3010 si occupé

# Vérifier disponibilité des ports:
# netstat -tlnp | grep -E "8080|8443|5434|3010"

# =====================================================================
# LOGGING
# =====================================================================

# Log level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOG_LEVEL=INFO

# Format: json (structuré) ou text (lisible)
LOG_FORMAT=json

# =====================================================================
# DOCKER-COMPOSE MEMORY LIMITS
# =====================================================================

# Adapter si serveur a moins de RAM (exemple: 4GB total)
#
# Serveur multi-tenant avec 8GB RAM:
#   Système/OS: 2GB
#   Lexikon: 1GB (backend 384MB + frontend 256MB + DB 200MB)
#   Autre app: 2GB
#   Cache: 3GB
#
# Dans docker-compose.prod.yml, adapter:
#   backend:
#     mem_limit: 384m          # Réduire à 256m si serveur petit
#     mem_reservation: 256m    # Réduire à 128m si serveur petit
#
#   frontend:
#     mem_limit: 256m          # Réduire à 128m si serveur petit
#     mem_reservation: 128m    # Réduire à 64m si serveur petit

# =====================================================================
# EXEMPLE DE DÉPLOIEMENT CHESSPLORER.COM
# =====================================================================

# FRONTEND_URL=https://lexikon.chessplorer.com
# CORS_ORIGINS=https://lexikon.chessplorer.com
#
# Ports utilisés:
# - Nginx: 8080:80, 8443:443 (éviter conflit avec Caddy sur 80/443)
# - PostgreSQL: 5434:5432 (éviter conflit avec chessplorer-postgres sur 5432)
# - Monitoring: 3010:3001 (éviter conflit avec chessplorer-uptime sur 3001)
#
# Reverse Proxy: Caddy
# - Caddy écoute sur 80/443 (public)
# - Nginx écoute sur 8080/8443 (interne)
# - Caddy redirige lexikon.chessplorer.com → localhost:8080
#
# Réseau Docker: lexikon_lexikon-network (bridge)
# - Partagé avec chessplorer pour inter-app communication si besoin

# =====================================================================
# COMMANDES UTILES
# =====================================================================

# Générer un secret sécurisé:
#   openssl rand -hex 32
#
# Tester la configuration:
#   docker-compose -f docker-compose.prod.yml config
#
# Démarrer les services:
#   docker-compose -f docker-compose.prod.yml --env-file .env.prod up -d
#
# Vérifier les logs:
#   docker-compose -f docker-compose.prod.yml logs -f backend
#
# Vérifier les métriques:
#   curl http://localhost:8000/metrics | jq .
#
# Vérifier la santé:
#   curl http://localhost:8000/health
#   curl http://localhost:3000/

# =====================================================================
# AIDE & DOCUMENTATION
# =====================================================================

# Documentation complète multi-tenant:
#   Voir: DEPLOYMENT_MULTI_TENANT.md
#
# Documentation standalone:
#   Voir: DEPLOYMENT.md
#
# Adaptations server-spécifiques (chessplorer.com):
#   Voir: README.SERVER_SPECIFIC.md
#
# Opérations production:
#   Voir: PRODUCTION_OPERATIONS.md
